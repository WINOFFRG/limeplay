{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "use-media-state-states",
  "type": "registry:hook",
  "registryDependencies": [
    "https://limeplay.winoffrg.dev/r/styles/default/utils.json",
    "https://limeplay.winoffrg.dev/r/styles/default/media-provider.json"
  ],
  "files": [
    {
      "path": "registry/default/hooks/use-media-state-states.ts",
      "content": "import React from \"react\"\n\nimport { noop, off, on } from \"@/registry/default/lib/utils\"\nimport { useMediaStore } from \"@/registry/default/ui/media-provider\"\n\n/**\n * Hooks doesnt return anything to prevent you from\n * using the hook again to access the states. Rather\n * always ask the store for the states you need.\n */\nexport function useMediaStates() {\n  const status = useMediaStore((state) => state.status)\n  const setStatus = useMediaStore((state) => state.setStatus)\n  const mediaRef = useMediaStore((state) => state.mediaRef)\n  const loop = useMediaStore((state) => state.loop)\n  const player = useMediaStore((state) => state.player)\n\n  React.useEffect(() => {\n    const mediaElement = mediaRef?.current\n    if (!mediaElement) return\n\n    if (!mediaElement.paused && (status === \"paused\" || status === \"stopped\")) {\n      mediaElement.pause()\n    } else if (status === \"playing\" && mediaElement.paused) {\n      mediaElement.play().catch((error) => {\n        // eslint-disable-next-line no-console\n        console.error(\"Error playing media\", error)\n        setStatus(\"error\")\n      })\n    }\n  }, [status, mediaRef])\n\n  React.useEffect(() => {\n    const mediaElement = mediaRef?.current\n    if (!mediaElement) return\n\n    if (loop) {\n      mediaElement.loop = true\n    } else {\n      mediaElement.loop = false\n    }\n  }, [loop, mediaRef])\n\n  React.useEffect(() => {\n    const mediaElement = mediaRef?.current\n    if (!mediaElement) return noop\n\n    const pauseHandler = () => setStatus(\"paused\")\n    const playHandler = () => setStatus(\"playing\")\n    const endedHandler = () => {\n      // DEV: Whenever in looping ended would never happen, so prevent UI from showing ended state\n      if (mediaElement?.loop) {\n        return\n      }\n      setStatus(\"ended\")\n    }\n\n    on(mediaElement, \"pause\", pauseHandler)\n    on(mediaElement, \"play\", playHandler)\n    on(mediaElement, \"ended\", endedHandler)\n\n    return () => {\n      off(mediaElement, \"pause\", pauseHandler)\n      off(mediaElement, \"play\", playHandler)\n      off(mediaElement, \"ended\", endedHandler)\n    }\n  }, [mediaRef])\n\n  // FIXME: In shaka buffering is also triggered when buffering has ended, so\n  // we need to check if we need to update the status manually, because it also\n  // automatically starts playing the content\n  React.useEffect(() => {\n    const bufferingHandler = () => {\n      console.log(\"Shaka Buffering\", player?.isBuffering())\n\n      if (player?.isBuffering() && status !== \"error\") {\n        setStatus(\"buffering\")\n      } else {\n        setStatus(\"playing\")\n      }\n    }\n\n    const waitingHandler = () => {\n      // console.log(\"Native Waiting\");\n      setStatus(\"buffering\")\n    }\n\n    const onPlayingHandler = () => {\n      // console.log(\"Native Playing\");\n      setStatus(\"playing\")\n    }\n\n    if (mediaRef?.current) {\n      on(mediaRef.current, \"waiting\", waitingHandler)\n      on(mediaRef.current, \"playing\", onPlayingHandler)\n    }\n\n    if (player) {\n      player.addEventListener(\"buffering\", bufferingHandler)\n      player.addEventListener(\"loading\", bufferingHandler)\n    }\n\n    return () => {\n      if (mediaRef?.current) {\n        off(mediaRef.current, \"waiting\", waitingHandler)\n        off(mediaRef.current, \"playing\", onPlayingHandler)\n      }\n\n      if (player) {\n        player.removeEventListener(\"buffering\", bufferingHandler)\n        player.removeEventListener(\"loading\", bufferingHandler)\n      }\n    }\n  }, [status, player])\n}\n",
      "type": "registry:hook"
    }
  ]
}