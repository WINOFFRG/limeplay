{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "use-media-state",
  "type": "registry:hook",
  "dependencies": [
    "zustand"
  ],
  "registryDependencies": [
    "https://limeplay.winoffrg.dev/r/styles/default/use-player-root-store.json",
    "https://limeplay.winoffrg.dev/r/styles/default/utils.json",
    "https://limeplay.winoffrg.dev/r/styles/default/media-provider.json"
  ],
  "files": [
    {
      "path": "registry/default/hooks/use-media-state.ts",
      "content": "import React from \"react\"\nimport type { StateCreator } from \"zustand\"\n\nimport type { PlayerRootStore } from \"@/registry/default/hooks/use-player-root-store\"\nimport { noop, off, on } from \"@/registry/default/lib/utils\"\nimport {\n  useGetStore,\n  useMediaStore,\n} from \"@/registry/default/ui/media-provider\"\n\nexport function useMediaStates() {\n  const store = useGetStore()\n  const mediaRef = useMediaStore((state) => state.mediaRef)\n  const player = useMediaStore((state) => state.player)\n\n  React.useEffect(() => {\n    if (!mediaRef.current) return noop\n\n    const media = mediaRef.current\n\n    const pauseHandler = () => {\n      store.setState({\n        paused: true,\n        status: \"paused\",\n      })\n    }\n\n    const playHandler = () => {\n      store.setState({\n        paused: false,\n        status: \"playing\",\n      })\n    }\n\n    const endedHandler = () => {\n      // DEV: Whenever in looping ended would never happen, so prevent UI from showing ended state\n      if (media.loop) {\n        return\n      }\n      store.setState({\n        ended: true,\n        status: \"ended\",\n      })\n    }\n\n    const loadedDataHandler = () => {\n      store.setState({\n        ended: false,\n      })\n    }\n\n    const loopChangeHandler = () => {\n      store.setState({\n        loop: media.loop,\n      })\n    }\n\n    on(media, \"pause\", pauseHandler)\n    on(media, \"play\", playHandler)\n    on(media, \"ended\", endedHandler)\n    on(media, \"loadeddata\", loadedDataHandler)\n    on(media, \"loopchange\", loopChangeHandler)\n\n    return () => {\n      off(media, \"pause\", pauseHandler)\n      off(media, \"play\", playHandler)\n      off(media, \"ended\", endedHandler)\n      off(media, \"loadeddata\", loadedDataHandler)\n      off(media, \"loopchange\", loopChangeHandler)\n    }\n  }, [store, mediaRef])\n\n  // Handle buffering states\n  React.useEffect(() => {\n    if (!mediaRef.current) return noop\n\n    const media = mediaRef.current\n\n    const bufferingHandler = () => {\n      if (player?.isBuffering()) {\n        store.setState({ status: \"buffering\" })\n      } else {\n        const isPlaying = media.paused\n        store.setState({ status: isPlaying ? \"paused\" : \"playing\" })\n      }\n    }\n\n    const waitingHandler = () => {\n      store.setState({ status: \"buffering\" })\n    }\n\n    const onPlayingHandler = () => {\n      store.setState({ status: \"playing\" })\n    }\n\n    on(media, \"waiting\", waitingHandler)\n    on(media, \"playing\", onPlayingHandler)\n\n    if (player) {\n      player.addEventListener(\"buffering\", bufferingHandler)\n      player.addEventListener(\"loading\", bufferingHandler)\n    }\n\n    return () => {\n      off(media, \"waiting\", waitingHandler)\n      off(media, \"playing\", onPlayingHandler)\n\n      if (player) {\n        player.removeEventListener(\"buffering\", bufferingHandler)\n        player.removeEventListener(\"loading\", bufferingHandler)\n      }\n    }\n  }, [store, mediaRef, player])\n}\n\nexport interface MediaStateStore {\n  paused: boolean\n  ended: boolean\n  loop: boolean\n}\n\nexport const createMediaStateStore: StateCreator<\n  MediaStateStore & PlayerRootStore,\n  [],\n  [],\n  MediaStateStore\n> = () => ({\n  paused: false,\n  ended: false,\n  loop: false,\n})\n\nexport function useMediaState() {\n  const store = useGetStore()\n\n  function play() {\n    const media = store.getState().mediaRef.current\n    if (!media) return\n\n    media.play().catch((error: unknown) => {\n      console.error(\"Error playing media\", error)\n      store.setState({\n        status: \"error\",\n        idle: false,\n      })\n    })\n\n    store.setState({\n      idle: false,\n    })\n  }\n\n  function pause() {\n    const media = store.getState().mediaRef.current\n    if (!media) return\n\n    media.pause()\n\n    store.setState({\n      idle: false,\n    })\n  }\n\n  function togglePaused() {\n    const media = store.getState().mediaRef.current\n    if (!media) return\n\n    if (media.paused) {\n      play()\n    } else {\n      pause()\n    }\n  }\n\n  function setLoop(loop: boolean) {\n    const media = store.getState().mediaRef.current\n    if (!media) return\n\n    media.loop = loop\n\n    store.setState({\n      idle: false,\n    })\n  }\n\n  function toggleLoop() {\n    const media = store.getState().mediaRef.current\n    if (!media) return\n\n    setLoop(!media.loop)\n  }\n\n  function seek(time: number) {\n    const media = store.getState().mediaRef.current\n    if (!media) return\n\n    media.currentTime = time\n\n    store.setState({\n      idle: false,\n    })\n  }\n\n  return {\n    play,\n    pause,\n    togglePaused,\n    setLoop,\n    toggleLoop,\n    seek,\n  }\n}\n",
      "type": "registry:hook"
    }
  ]
}