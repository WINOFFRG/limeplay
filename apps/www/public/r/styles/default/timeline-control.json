{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "timeline-control",
  "type": "registry:ui",
  "dependencies": [
    "@base-ui-components/react/slider"
  ],
  "registryDependencies": [
    "https://limeplay.winoffrg.dev/r/styles/default/media-provider.json",
    "https://limeplay.winoffrg.dev/r/styles/default/utils.json",
    "https://limeplay.winoffrg.dev/r/styles/default/use-timeline.json",
    "https://limeplay.winoffrg.dev/r/styles/default/use-track-events.json"
  ],
  "files": [
    {
      "path": "registry/default/ui/timeline-control.tsx",
      "content": "\"use client\"\n\nimport React, { useImperativeHandle, useRef } from \"react\"\nimport { Slider as SliderPrimitive } from \"@base-ui-components/react/slider\"\n\nimport { cn } from \"@/lib/utils\"\nimport { useTimeline } from \"@/registry/default/hooks/use-timeline\"\nimport { useTrackEvents } from \"@/registry/default/hooks/use-track-events\"\nimport { useMediaStore } from \"@/registry/default/ui/media-provider\"\n\nexport const Root = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof SliderPrimitive.Root>\n>((props, ref) => {\n  const internalRef = useRef<HTMLDivElement>(\n    null\n  ) as React.RefObject<HTMLDivElement>\n  const { className, orientation = \"horizontal\", ...etc } = props\n\n  const currentTime = useMediaStore((s) => s.currentTime)\n  const duration = useMediaStore((s) => s.duration)\n  const currentValue = duration ? (currentTime / duration) * 100 : 0\n\n  useImperativeHandle(ref, () => internalRef.current)\n  const { seek, setHoveringTime, setIsHovering, getTimeFromEvent } =\n    useTimeline()\n\n  const trackEvents = useTrackEvents({\n    onPointerDown: (progress, event) => {\n      const newTime = getTimeFromEvent(event)\n      if (duration) {\n        seek(newTime)\n      }\n    },\n    onPointerMove: (progress, isPointerDown, event) => {\n      if (duration) {\n        setHoveringTime(getTimeFromEvent(event))\n        setIsHovering(true)\n\n        if (isPointerDown) {\n          seek(getTimeFromEvent(event))\n        }\n      }\n    },\n    onPointerUp: () => {\n      setIsHovering(false)\n    },\n    orientation,\n  })\n\n  return (\n    <SliderPrimitive.Root\n      value={[currentValue]}\n      className={cn(\n        `\n          relative h-1 rounded-full transition-[height] duration-[var(--speed-regularTransition)] ease-[var(--ease-out-quad)]\n          data-[orientation=horizontal]:h-[var(--lp-timeline-track-height)]\n          active:data-[orientation=horizontal]:h-[var(--lp-timeline-track-height-active)]\n        `,\n        className\n      )}\n      aria-label=\"Timeline Slider\"\n      orientation={orientation}\n      ref={internalRef}\n      {...trackEvents}\n      {...etc}\n    />\n  )\n})\n\nRoot.displayName = \"SliderRoot\"\n\nexport const Track = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof SliderPrimitive.Track>\n>((props, ref) => {\n  const { className, ...etc } = props\n\n  return (\n    <SliderPrimitive.Track\n      ref={ref}\n      tabIndex={0}\n      className={cn(\n        `\n          relative h-full grow rounded-full bg-white/20\n          focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary/50\n        `,\n        className\n      )}\n      {...etc}\n    />\n  )\n})\n\nTrack.displayName = \"SliderTrack\"\n\nexport const Progress = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof SliderPrimitive.Track>\n>((props, ref) => {\n  const { className, ...etc } = props\n\n  const progress = useMediaStore((s) => s.progress)\n\n  return (\n    <SliderPrimitive.Indicator\n      ref={ref}\n      className={cn(\n        \"h-full w-(--lp-played-width) rounded-s-full bg-white\",\n        className\n      )}\n      style={\n        {\n          \"--lp-played-width\": `${progress * 100}%`,\n        } as React.CSSProperties\n      }\n      {...etc}\n    />\n  )\n})\n\nProgress.displayName = \"SliderProgress\"\n\ninterface ThumbProps\n  extends React.ComponentProps<typeof SliderPrimitive.Thumb> {\n  /**\n   * Custom position of the thumb in percentage\n   */\n  position?: number\n  /**\n   * Thumb moves with the cursor seeking over the timeline\n   */\n  showWithHover?: boolean\n}\n\ninterface BufferedProps\n  extends React.ComponentProps<typeof SliderPrimitive.Track> {\n  variant?: \"combined\" | \"from-zero\" | \"default\"\n}\n\nexport const Buffered = React.forwardRef<HTMLDivElement, BufferedProps>(\n  (props, ref) => {\n    const { className, variant = \"default\", ...etc } = props\n\n    const buffered = useMediaStore((s) => s.buffered)\n    const duration = useMediaStore((s) => s.duration)\n\n    if (!duration || !buffered.length) {\n      return null\n    }\n\n    let normalizedBuffered: shaka.extern.BufferedRange[] = []\n\n    if (variant === \"combined\") {\n      const combinedBuffered = buffered.reduce(\n        (acc, range) => {\n          acc.start = Math.min(acc.start, range.start)\n          acc.end = Math.max(acc.end, range.end)\n          return acc\n        },\n        { start: Infinity, end: 0 }\n      )\n\n      if (combinedBuffered.start !== Infinity) {\n        normalizedBuffered = [\n          {\n            start: combinedBuffered.start,\n            end: combinedBuffered.end,\n          },\n        ]\n      }\n    } else if (variant === \"from-zero\") {\n      normalizedBuffered = buffered.map((range) => ({\n        start: 0,\n        end: range.end,\n      }))\n    } else {\n      normalizedBuffered = buffered\n    }\n\n    if (!normalizedBuffered.length) {\n      return null\n    }\n\n    return (\n      <div ref={ref} className={cn(\"absolute size-full\", className)} {...etc}>\n        {normalizedBuffered.map((range, i: number) => {\n          const startPercent = (range.start / duration) * 100\n          const widthPercent = ((range.end - range.start) / duration) * 100\n          return (\n            <SliderPrimitive.Track\n              key={i}\n              className={`absolute left-[var(--lp-buffered-start)] h-full w-[var(--lp-buffered-width)] rounded-e-full bg-white/40`}\n              style={\n                {\n                  \"--lp-buffered-start\": `${startPercent}%`,\n                  \"--lp-buffered-width\": `${widthPercent}%`,\n                } as React.CSSProperties\n              }\n            />\n          )\n        })}\n      </div>\n    )\n  }\n)\n\nBuffered.displayName = \"SliderBuffered\"\n\nexport const Thumb = React.forwardRef<HTMLDivElement, ThumbProps>(\n  (props, ref) => {\n    const { className, position, showWithHover = false, ...etc } = props\n    const hoveringTime = useMediaStore((s) => s.hoveringTime)\n    const duration = useMediaStore((s) => s.duration)\n    const currentTime = useMediaStore((s) => s.currentTime)\n\n    let finalPosition = 0\n\n    if (!duration) {\n      return null\n    }\n\n    if (position && Number.isFinite(position)) {\n      finalPosition = position\n    } else if (showWithHover) {\n      finalPosition = (hoveringTime / duration) * 100\n    } else {\n      finalPosition = (currentTime / duration) * 100\n    }\n\n    return (\n      <SliderPrimitive.Thumb\n        className={cn(\n          \"left-(--lp-timeline-thumb-position)! size-4 rounded-full bg-white\",\n          className\n        )}\n        ref={ref}\n        {...etc}\n        style={\n          {\n            \"--lp-timeline-thumb-position\": `${finalPosition}%`,\n          } as React.CSSProperties\n        }\n      />\n    )\n  }\n)\n\nThumb.displayName = \"SliderThumb\"\n",
      "type": "registry:ui"
    }
  ]
}